<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engineering College Archive</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
          --primary: #4361ee;
          --primary-dark: #3a56d4;
          --success: #22c55e;
          --danger: #f87171;
          --gray-light: #f1f5f9;
          --gray-dark: #1e293b;
          --font-main: 'Inter', sans-serif;
        }
      
        body {
          font-family: var(--font-main);
          background-color: #f5f7fa;
          margin: 0;
          padding: 2rem 1rem;
          color: var(--gray-dark);
        }
      
        .container {
          max-width: 1200px;
          margin: 0 auto 2rem;
          padding: 2rem;
          background-color: white;
          border-radius: 12px;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.04);
        }
      
        h1 {
          font-size: 2rem;
          font-weight: 700;
          margin-bottom: 1.5rem;
          text-align: center;
          color: var(--gray-dark);
        }
      
        .departments-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
          gap: 1.5rem;
        }
      
        .department-card {
          background-color: #ffffff;
          border: 1px solid #e2e8f0;
          border-radius: 10px;
          padding: 2rem;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
          transition: all 0.2s ease-in-out;
          text-align: center;
          font-weight: 600;
          color: var(--gray-dark);
          cursor: pointer;
        }
      
        .department-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
          border-color: var(--primary);
        }
      
        .department-card i {
          font-size: 2.25rem;
          color: var(--primary);
          margin-bottom: 0.75rem;
        }
      
        .subject-button {
          background-color: var(--primary);
          color: #fff;
          border: none;
          border-radius: 6px;
          padding: 0.75rem 1.25rem;
          margin: 0.5rem;
          font-size: 0.9rem;
          font-weight: 500;
          transition: background-color 0.2s;
          cursor: pointer;
        }
      
        .subject-button:hover {
          background-color: var(--primary-dark);
        }
      
        .back-button {
          position: absolute;
          top: 1.25rem;
          left: 1.25rem;
          background: transparent;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: var(--gray-dark);
          transition: background-color 0.2s;
        }
      
        .back-button:hover {
          background-color: #e2e8f0;
          border-radius: 6px;
        }
      
        #fileInputAndButton {
          display: flex;
          gap: 0.75rem;
          margin-bottom: 1rem;
          flex-wrap: wrap;
        }
      
        label,
        button {
          background-color: var(--primary);
          color: white;
          padding: 0.625rem 1rem;
          border-radius: 6px;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          border: none;
          transition: background-color 0.2s;
        }
      
        label:hover,
        button:hover {
          background-color: var(--primary-dark);
        }
      
        input[type="file"] {
          display: none;
        }
      
        #uploadMessage {
          margin-top: 1rem;
          padding: 0.75rem;
          border-radius: 6px;
          font-size: 0.9rem;
          font-weight: 600;
          text-align: center;
        }
      
        #fileList {
          margin-top: 1rem;
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 1rem;
          padding: 0;
          list-style: none;
        }
      
        #fileList li {
          background-color: var(--gray-light);
          padding: 1rem;
          border-radius: 10px;
          border: 1px solid #e5e7eb;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
          transition: transform 0.2s ease;
        }
      
        #fileList li:hover {
          transform: translateY(-4px);
          box-shadow: 0 6px 14px rgba(0, 0, 0, 0.06);
        }
      
        .file-name {
          font-weight: 600;
          color: var(--gray-dark);
        }
      
        .file-size {
          font-size: 0.8rem;
          color: #6b7280;
        }
      
        .thumbnail {
          max-height: 80px;
          border-radius: 6px;
        }
      
        a {
          text-decoration: none;
          padding: 0.4rem 0.75rem;
          border-radius: 6px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          background-color: var(--primary);
          transition: background-color 0.2s;
          display: inline-block;
        }
      
        a:hover {
          background-color: var(--primary-dark);
        }
      
        .view-button {
          background-color: var(--success);
        }
      
        .view-button:hover {
          background-color: #16a34a;
        }
      
        .error {
          background-color: var(--danger);
          color: white;
        }
      
        .success {
          background-color: #d4edda;
          color: #155724;
        }
      
        .hidden {
          display: none;
        }
      
        @media (max-width: 768px) {
          .departments-grid {
            grid-template-columns: 1fr;
          }
      
          #fileList {
            grid-template-columns: 1fr;
          }
        }
      </style>
      
</head>
<body>
    <div class="container" id="main-page">
        <button class="back-button" onclick="showMainPage()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
        <h1>ABET AQU Archive</h1>
        <div class="departments-grid">
            <div class="department-card" id="computer-engineering">
                <i class="fas fa-microchip fa-2x mb-2"></i><br>
                Computer Engineering
            </div>
            <div class="department-card" id="materials-engineering">
                <i class="fas fa-flask fa-2x mb-2"></i><br>
                Materials Engineering
            </div>
            <div class="department-card" id="architecture-engineering">
                <i class="fas fa-building fa-2x mb-2"></i><br>
                Architecture Engineering
            </div>
            <div class="department-card" id="electronics-communications">
                <i class="fas fa-bolt fa-2x mb-2"></i><br>
                Electronics and Communications Engineering
            </div>
        </div>
    </div>

    <div class="container hidden" id="subject-page">
        <button class="back-button" onclick="showMainPage()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
        <h1>Select Subject</h1>
        <div id="subject-buttons-container" style="display: flex; flex-wrap: wrap; justify-content: center;">
        </div>
    </div>

    <div class="container hidden" id="upload-page">
        <h1>Upload/Edit Files</h1>
        <div id="upload-form-container">
        </div>
    </div>

    <script>
        const mainPage = document.getElementById('main-page');
        const subjectPage = document.getElementById('subject-page');
        const uploadPage = document.getElementById('upload-page');
        const subjectButtonsContainer = document.getElementById('subject-buttons-container');
        const uploadFormContainer = document.getElementById('upload-form-container');

        const departments = [
            { id: 'computer-engineering', name: 'Computer Engineering', subjects: ['Introduction to Computer Engineering', 'Programming 1', 'Programming 2'] },
            { id: 'materials-engineering', name: 'Materials Engineering', subjects: ['Introduction to Materials Science', 'Properties of Materials', 'Materials Processing'] },
            { id: 'architecture-engineering', name: 'Architecture Engineering', subjects: ['Architectural Design 1', 'Architectural Design 2', 'History of Architecture'] },
            { id: 'electronics-communications', name: 'Electronics and Communications Engineering', subjects: ['Electronics 1', 'Electronics 2', 'Communications'] },
        ];

        let selectedDepartment = '';
        let selectedSubject = '';
        let previousDepartment = ''; // To store the previously selected department


        document.getElementById('computer-engineering').addEventListener('click', () => showSubjectPage('computer-engineering'));
        document.getElementById('materials-engineering').addEventListener('click', () => showSubjectPage('materials-engineering'));
        document.getElementById('architecture-engineering').addEventListener('click', () => showSubjectPage('architecture-engineering'));
        document.getElementById('electronics-communications').addEventListener('click', () => showSubjectPage('electronics-communications'));

        function showMainPage() {
            mainPage.classList.remove('hidden');
            subjectPage.classList.add('hidden');
            uploadPage.classList.add('hidden');
            subjectButtonsContainer.innerHTML = '';
            uploadFormContainer.innerHTML = '';
            previousDepartment = ''; // Reset previous department when going to main page
        }

        function showSubjectPage(departmentId) {
            selectedDepartment = departmentId;
            mainPage.classList.add('hidden');
            subjectPage.classList.remove('hidden');
            uploadPage.classList.add('hidden');
            subjectButtonsContainer.innerHTML = ''; // Clear previous content

            const department = departments.find(dept => dept.id === departmentId);
            if (department) {
                department.subjects.forEach(subject => {
                    const subjectButton = document.createElement('button');
                    subjectButton.className = 'subject-button';
                    subjectButton.textContent = subject;
                    subjectButton.onclick = () => showUploadPage(departmentId, subject);
                    subjectButtonsContainer.appendChild(subjectButton);
                });
                previousDepartment = departmentId; // Store the current department
            } else {
                subjectButtonsContainer.innerHTML = '<p>Department not found.</p>';
            }
        }

        function showUploadPage(departmentId, subject) {
    selectedSubject = subject;
    mainPage.classList.add('hidden');
    subjectPage.classList.remove('hidden'); // Keep subject page visible
    uploadPage.classList.remove('hidden');
    uploadFormContainer.innerHTML = '';

    const form = document.createElement('form');
    form.id = 'uploadForm';
    form.enctype = 'multipart/form-data';
    form.innerHTML = `
        <div id="fileInputAndButton">
            <input id="fileInput" type="file" name="files" multiple accept="*" />
            <label for="fileInput">Choose Files</label>
            <button type="submit">Upload</button>
        </div>
        <div id="selectedFilesPreview" style="margin-top: 1rem;"></div>
        <div id="uploadMessage" style="margin-top: 1.5rem; font-weight: 600; text-align: center; padding: 0.5rem; border-radius: 0.375rem; border: 1px solid transparent; display: none;"></div>
        <h2>Files for ${subject}</h2>
        <ul id="fileList"></ul>
    `;
    uploadFormContainer.appendChild(form);

    const uploadForm = document.getElementById('uploadForm');
    const fileInput = document.getElementById('fileInput');
    const fileInputLabel = uploadForm.querySelector('label[for="fileInput"]');
    const uploadMessage = document.getElementById('uploadMessage');
    const fileList = document.getElementById('fileList');
    const previewContainer = document.getElementById('selectedFilesPreview');

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    async function fetchFiles() {
        try {
            const response = await fetch(`/files?department=${selectedDepartment}&subject=${selectedSubject}`);
            if (response.ok) {
                const files = await response.json();
                displayFiles(files);
            } else {
                console.error('Failed to fetch files:', response.status);
                uploadMessage.textContent = 'Failed to fetch files.';
                uploadMessage.style.display = 'block';
                uploadMessage.style.backgroundColor = '#f87171';
                uploadMessage.style.color = '#fff';
            }
        } catch (error) {
            console.error('Error fetching files:', error);
        }
    }

    function displayFiles(files) {
        fileList.innerHTML = '';
        if (!files || files.length === 0) {
            fileList.innerHTML = '<li>No files available.</li>';
            return;
        }

        files.forEach(file => {
            const listItem = document.createElement('li');

            if (file.isImage) {
                const img = document.createElement('img');
                img.src = file.webViewLink;
                img.classList.add('thumbnail');
                listItem.appendChild(img);
            }

            const nameSpan = document.createElement('span');
            nameSpan.textContent = file.name;
            nameSpan.classList.add('file-name');
            listItem.appendChild(nameSpan);

            const sizeSpan = document.createElement('span');
            sizeSpan.textContent = file.size ? formatFileSize(file.size) : 'Size N/A';
            sizeSpan.classList.add('file-size');
            listItem.appendChild(sizeSpan);

            const downloadLink = document.createElement('a');
            downloadLink.href = `/download/${file.id}?department=${selectedDepartment}&subject=${selectedSubject}`;
            downloadLink.textContent = 'Download';
            listItem.appendChild(downloadLink);

            const viewLink = document.createElement('a');
            viewLink.href = file.webViewLink;
            viewLink.textContent = 'View';
            viewLink.classList.add('view-button');
            viewLink.target = '_blank';
            listItem.appendChild(viewLink);

            fileList.appendChild(listItem);
        });
    }

    uploadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(uploadForm);
        uploadMessage.textContent = 'Uploading...';
        uploadMessage.style.display = 'block';
        uploadMessage.style.backgroundColor = '#dbeafe';
        uploadMessage.style.color = '#1e40af';

        try {
            const response = await fetch(`/upload?department=${selectedDepartment}&subject=${selectedSubject}`, {
                method: 'POST',
                body: formData,
            });

            if (response.ok) {
                const data = await response.json();
                uploadMessage.textContent = 'Successfully uploaded!';
                uploadMessage.style.backgroundColor = '#d4edda';
                uploadMessage.style.color = '#155724';
                fetchFiles();
                uploadForm.reset();
                fileInputLabel.textContent = 'Choose Files';
                previewContainer.innerHTML = '';
            } else {
                const errorData = await response.text();
                uploadMessage.textContent = `Upload failed: ${errorData}`;
                uploadMessage.style.backgroundColor = '#f87171';
                uploadMessage.style.color = '#fff';
            }
            setTimeout(() => {
                uploadMessage.style.display = 'none';
            }, 3000);
        } catch (error) {
            uploadMessage.textContent = `Upload error: ${error.message}`;
            uploadMessage.style.backgroundColor = '#f87171';
            uploadMessage.style.color = '#fff';
        }
    });

    fileInput.addEventListener('change', function () {
        previewContainer.innerHTML = '';

        if (fileInput.files && fileInput.files.length > 0) {
            fileInputLabel.textContent = 'Change Files';

            Array.from(fileInput.files).forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.style.marginBottom = '0.5rem';
                fileItem.style.fontSize = '0.9rem';

                let fileDetails = `<strong>${file.name}</strong> (${formatFileSize(file.size)})`;

                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.maxHeight = '100px';
                        img.style.marginTop = '0.5rem';
                        img.style.borderRadius = '0.375rem';
                        fileItem.innerHTML = fileDetails;
                        fileItem.appendChild(img);
                        previewContainer.appendChild(fileItem);
                    };
                    reader.readAsDataURL(file);
                } else {
                    fileItem.innerHTML = fileDetails;
                    previewContainer.appendChild(fileItem);
                }
            });
        } else {
            fileInputLabel.textContent = 'Choose Files';
            previewContainer.innerHTML = '';
        }
    });

    fetchFiles();
    setInterval(fetchFiles, 5000);
}


        // Show the main page when the script loads
        showMainPage();
    </script>
    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
</body>
</html>
